{% extends 'base/base.html' %}
{% load static %}
{% load humanize %}
{% block css_files %}
{% endblock %}
{% block title_bar %}
<div class="row border bg-gardient-secondary rounded" style="padding: 10px;">
    <div class="col-4">
        <i class="fa fa-list"></i>
        {{ title_page }} <strong> [{{ total_records }} registros]</strong>
    </div>
            <div class="col-4 text-center h5">Migraciones SAP</div>
    <div class="col-4 text-right">
        [Sistema Toma Inventarios] | Módulo {{ module_name }} 
        <span class="text-primary">
            [{{ total_time | floatformat:2 }} segs]
        </span>
    </div>
</div>
{% endblock %}
{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col" style="padding: 10px;">
            <table class="table table-bordered table-condensed table-hover">
                <tbody>
                    <tr>
                        <th class="text-right bg-light">
                            Total
                        </th>
                        <td class="text-right">
                            <strong>{{ total_records }}</strong> migraciones
                        </td>
                        <th class="text-right bg-light">
                            Última:
                        </th>
                        <td class="text-right">
                            <a href="/sap/detail/{{last_migration.migration.pk}}">
                                <strong>
                                    [{{last_migration.migration.pk}}]
                                </strong>
                                |
                                {{ last_migration.user.create_by }}
                                |
                                {{ last_migration.migration.created | naturalday }}
                            </a>
                        </td>
                        <td class="text-right">
                            <a href="/sap/?migrate=true" class="btn btn-outline-dark btn-xs">
                                <i class="fas fa-share text-info"></i>
                                Importar Saldos SAP
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
  
    <div class="row">
        <div class="col">
            <table class="table table-bordered table-hover" id="table">
                <thead>
                    <tr class="text-center bg-gradient-secondary">
                        <th>#</th>
                        <th>Fecha</th>
                        <th>Usuario</th>
                        <th>Bodegas</th>
                        <th>Productos</th>
                        <th>Unidades</th>
                        <th>Tomas</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for migration in all_migrations %}
                    <tr {% if forloop.first %} class="bg-gradient-light-selector" {% endif %}>
                        <td class="text-center" data-toggle="modal" data-target="#detailModal">
                                &nbsp;{{ forloop.counter }}&nbsp;
                        </td>
                        <td>
                            {% if migration.migration.is_active %}
                                <i class="fas fa-lock-open text-success"></i>
                            {% else %}
                                <i class="fas fa-lock"></i>
                            {% endif%}
                            <a href="/sap/detail/{{migration.migration.pk}}">
                                <span class="text-secondary">#{{migration.migration.pk}}</span>
                            </a>
                        </td>
                        <td class="text-center">{{ migration.user.create_by }}</td>
                        <td class="text-center">{{ migration.migration.total_warenhouses | intcomma }}</td>
                        <td class="text-center">{{ migration.migration.total_products | intcomma }}</td>
                        <td class="text-center">{{ migration.migration.total_products_unities | intcomma }}</td>
                        <td class="text-center">
                            {% if not migration.takings %}
                            <span class="text-secondary">SIN TOMAS</span>
                            {% endif %}
                            {% for taking in migration.takings%}
                                {% if forloop.first %}
                                    <span class="text-seconday"> | </span>
                                {% endif %}
                                <a href="/takings/detail/{{taking.pk}}">{{ taking.notes }}</a>
                                    |
                                {% endfor %}
                        </td>
                        <td class="text-center">
                            {% if migration.migration.is_active %}
                                <span class="text-success">Abierto</span>
                            {% else %}
                                <span class="text-secondary">Cerrado</span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <a href="/takings/create/{{ migration.migration.pk }}">
                                <i class="fas fa-clipboard text-info"></i>
                            </a>
                            {% if not migration.takings %}
                            &nbsp; <span class="text-secondary">|</span> &nbsp;
                            <a href="/takings/delete/{{ migration.migration.pk }}/">
                                <i class="fas fa-trash text-danger"></i>
                            </a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
{% block scritp_code %}
<script src="{% static 'js/vue.global.js' %}"></script>
{% endblock %}